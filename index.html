<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Enforcing Quality with Tools</title>

    <meta name="description" content="Enforcing Quality with Tools presentation" />
    <meta name="author" content="Artur Dorochowicz" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <link rel="stylesheet" href="reveal.js/css/reveal.min.css" />
    <link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme" />

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css" />

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
        document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->
</head>
<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1>Enforcing Quality with Tools</h1>
            <h3>Artur Dorochowicz</h3>
            <p>
                <a href="https://github.com/ArturDorochowicz/" target="_blank">
                    https://github.com/ArturDorochowicz/</a>
            </p>
        </section>

        <section data-transition="linear" data-background="#4d7e65" data-background-transition="slide">
            <h2>Agenda</h2>
            <ol>
                <li>Visual Studio Code Analysis</li>
                <li>StyleCop</li>
                <li>JSHint</li>
            </ol>
        </section>

        <section>
            <h2>Principles</h2>
            <ol>
                <li>Automation - tool is part of the build</li>
                <li>Enforcement - violations fail the build</li>
                <li>Available in Visual Studio</li>
                <li>Per project settings, with shared defaults</li>
            </ol>
        </section>

        <section data-transition="linear" data-background="#8c4738" data-background-transition="slide">
            <h2>Visual Studio Code Analysis</h2>
        </section>

        <section>
            <h2>What's wrong with this code?</h2>
            <pre><code data-trim contenteditable>
using (var smtp = new SmtpClient { Host = "smtp.gmail.com" })
{
    smtp.Send("from@from.com", "to@to.com", "subject", "body");
}
            </code></pre>
        </section>

        <section>
            <h2>Code Analysis</h2>
            <ul>
                <li>Static analysis tool of managed assemblies - analyses binaries</li>
                <li>Validates against .NET Framework Design Guidelines</li>
                <li>Integrated into Visual Studio and the build system</li>
                <li>In VS2010 available only in Premium and Ultimate</li>
                <li>In VS2012 available in all paid editions as well as in Express with limited number of rules</li>
                <li>FxCop - standalone analysis tool (fxcopcmd.exe) with somewhat
                    <a href="http://archive.msdn.microsoft.com/codeanalysis/Release/ProjectReleases.aspx?ReleaseId=556" target="_blank">different set</a> of
                    <a href="http://shoutakenaka-devlog.blogspot.com/2011/01/comparison-of-visual-studio-code.html" target="_blank">rules</a>;<br/>
                    Available in Microsoft Download Center and in Windows SDK; Microsoft is phasing it out</li>
            </ul>
        </section>

        <section>
            <h2>Installation</h2>
            <ul>
                <li>Nothing to install - Code Analysis is part of the build out of the box</li>
                <li>Integration with the build is governed by an MSBuild project file</li>
                <li>Available configuration options can be discovered from here</li>
            </ul>
            <pre><code data-trim contenteditable>
$(MSBuildExtensionPath)\Microsoft\VisualStudio\v11.0\CodeAnalysis\Microsoft.CodeAnalysis.Targets
            </code></pre>
        </section>

        <section data-transition="linear" data-background="#8c4738" data-background-transition="slide">
            <h2>StyleCop</h2>
        </section>

        <section>
            <h2>StyleCop</h2>
            <ul>
                <li>Source code style verification tool - for C# code only</li>
                <li>Validates against .NET Framework Design Guidelines and formatting style recommended by Microsoft</li>
                <li>Originally an internal Microsoft tool, later released to the public</li>
                <li>Now it's an open source project - <a href="https://stylecop.codeplex.com/" target="_blank">stylecop.codeplex.com</a></li>
            </ul>
        </section>

        <section>
            <h2>Installation</h2>
            <p>Install <a href="https://www.nuget.org/packages/StyleCop.MSBuild/" target="_blank">StyleCop.MSBuild</a> NuGet package into each project where the analysis is desired</p>
            <pre><code data-trim contenteditable>
PM> Install-Package StyleCop.MSBuild
            </code></pre>
        </section>

        <section>
            <h2>MSBuild Properties</h2>
            <ul>
                <li><em>StyleCopEnabled</em> - enables the analysis, <em>true</em> by default which makes the analysis run on each build</li>
                <li><em>StyleCopTreatErrorsAsWarnings</em> - report issues as warnings, <em>true</em> by default</li>
            </ul>

            <p>Recommended settings should be added to each project file manually</p>
            <pre><code data-trim contenteditable>
&lt;PropertyGroup>
    &lt;StyleCopEnabled>false&lt;/StyleCopEnabled>
    &lt;StyleCopTreatErrorsAsWarnings>false&lt;/StyleCopTreatErrorsAsWarnings>
&lt;/PropertyGroup>
            </pre></code>

            <aside class="notes">
                StyleCopEnabled = false - it's probably a bit too cumbersome to have StyleCop run on each build.
                StyleCopTreatErrorsAsWarnings = false - since we want to enforce the quality and break the build when violations are found.
            </aside>
        </section>

        <section>
            <h2>Visual Studio integration</h2>
            <p>
                Integration makes it easier to configure StyleCop, but is irrelevant for the analysis during the build.
            </p>
            <p>
                Installer at <a href="https://stylecop.codeplex.com/" target="_blank">stylecop.codeplex.com</a> includes Visual Studio extension,
                JetBrains ReSharper plugin as well as StyleCop MSBuild targets.
            </p>

            <aside class=notes>
                Installed StyleCop MSBuild targets are irrelevant here due to the use of NuGet package for analysis during the build.
            </aside>
        </section>

        <section>
            <h2>Configuration</h2>
            <p>
                By default StyleCop searches for configuration files &mdash; <em>Settings.StyleCop</em> &mdash; from the project directory up.
            </p>
            <p>
                Multiple files are merged from top to bottom allowing for the recommended setup:
            </p>
            <ul>
                <li>common settings file for the solution in the solution directory</li>
                <li>project specific overrides in each individual project directory</li>
            </ul>

            <aside class="notes">
                By default the configuration file search really ends with the default settings file (here: settings file in the <em>tools</em> directory of the StyleCop NuGet package.)

                Default settings of automatically searching in parent directories may potentially result in including unrelated configuration files placed above the solution level
                and result in different build output depending on build location. This is build nondeterminism and It's a Bad Thing (TM). In reality it's probably not an issue.

                A settings file can be easily created with StyleCop Visual Studio extension - from project context menu in VS.

                To manage a configuration file without the VS extension: create Settings.StyleCop file with just the root configuration element - &lt;StyleCopSettings/>.
                Next, run the settings editor on it (it's in the tools directory of the StyleCop NuGet package):
                > StyleCopSettingsEditor.exe path/to/created/settings/file
            </aside>
        </section>

        <section>
            <h2>Rules</h2>
            <p>The default rule set includes all of the rules</p>
            <p>Consider disabling some of them:</p>
            <ul>
                <li>Documentation rules</li>
                <li><em>UsingDirectivesMustBePlacedWithinNamespace</em></li>
                <li><em>AccessModifierMustBeDeclared</em></li>
                <li><em>PrefixLocalCallsWithThis</em>, <em>PrefixCallsCorrectly</em>, <em>FieldNamesMustNotBeginWithUnderscore</em></li>
            </ul>

            <aside class="notes">
                UsingDirectivesMustBePlacedWithinNamespace - even VS templates don't follow this rule
                AccessModifierMustBeDeclared - less code ceremony
                PrefixLocalCallsWithThis, PrefixCallsCorrectly, FieldNamesMustNotBeginWithUnderscore - no need for <em>this.</em> or <em>base.</em> unless really required
            </aside>
        </section>

        <section>
            <h2>Suppressing violations</h2>
            <p>Violations can be selectively suppressed with Code Analysis' <em>SuppressMessage</em> attribute</p>
            <pre><code data-trim contenteditable>
[System.Diagnostics.CodeAnalysis.SuppressMessage(
    "StyleCop.CSharp.OrderingRules", 
    "SA1202:ElementsMustBeOrderedByAccess",
    Justification = "Optional, but you should always provide one.")]
public class MyClass
{
    static void PrivateBeforePublic()
    {
    }

    public static void Public()
    {
    }
}
            </code></pre>
        </section>

        <section>
            <h2>Introducing to legacy projects</h2>
            <p>
                StyleCop Visual Studio extension allows to exclude individual files from the analysis
            </p>
            <pre><code data-trim contenteditable>
&lt;Compile Include="ThisFileIsExludedFromStyleCop.cs">
    &lt;ExcludeFromStyleCop>True&lt;/ExcludeFromStyleCop>
&lt;/Compile>
            </code></pre>
            <p>
                Use <em>ExcludeFromStyleCop</em> tool for mass exclusion
            </p>
            <ul>
                <li><a href="http://blogs.msdn.com/b/sourceanalysis/archive/2008/11/11/introducing-stylecop-on-legacy-projects.aspx" target="_blank">Introducing StyleCop on Legacy Projects</a></li>
                <li><a href="https://stylecop.codeplex.com/releases/view/48036" target="_blank">StyleCop 4.3 Release Download</a></li>
                <li><a href="https://stylecop.codeplex.com/downloads/get/129745" target="_blank">ExcludeFromStyleCop</a></li>
            </ul>

            <aside class="notes">
                ExcludeFromStyleCop tool needs to be compiled - it's made available in source code form only.
            </aside>
        </section>

        <section>
            <h2>ReSharper integration</h2>
            <p>Plugin for ReSharper does not use <em>Settings.StyleCop</em> files &mdash; matching configuration needs to be established again in ReSharper options.</p>
            <p>The division of StyleCop settings into solution and project level settings files can be matched with ReSharper team-shared solution level and project level settings and committing them to source control.</p>
            <ul>
                <li><a href="http://blog.jetbrains.com/dotnet/2011/11/22/resharper-settings-in-61/" target="_blank">ReSharper Settings - JetBrains blog</a></li>
                <li><a href="https://jkanczler.wordpress.com/2013/09/27/share-style-cop-compatible-resharper-settings-between-different-machines/" target="_blank">Share Style Cop compatible ReSharper settings between different machines - József Kanczler</a></li>
            </ul>
        </section>

        <section>
            <h2>Execution</h2>
            <p>Example command line</p>
            <pre><code data-trim contenteditable>
msbuild MySolution.sln
    /target:Build
    /property:Configuration=Release
    /property:StyleCopEnabled=true
            </pre></code>
        </section>

        <section data-transition="linear" data-background="#8c4738" data-background-transition="slide">
            <h2>JSHint</h2>
        </section>

        <section>
            <h2>What's wrong with this code?</h2>
            <pre><code data-trim contenteditable>
function calculateCost(order) {
    return
        order.getProductsTotal() +
        order.getShippingCost();
}
            </code></pre>
        </section>


        <section>
            <h2>JSHint</h2>
            <ul>
                <li><q>JSHint, a JavaScript Code Quality Tool</q> - <a href="http://www.jshint.com" target="_blank">www.jshint.com</a></li>
                <li>JavaScript analysis tool, detects errors and potential problems</li>
                <li>There is some code style verification, but it will be removed in a future version</li>
                <li>Community fork of Douglas Crockford's <a href="http://www.jslint.com/" target="_blank">JSLint</a></li>
            </ul>
        </section>

        <section>
            <h1>Enforcing Quality with Tools</h1>
            <h3>Artur Dorochowicz</h3>
            <p>
                <small>
                    <a href="https://github.com/ArturDorochowicz/presentation-enforcing-quality-with-tools" target="_blank">
                        https://github.com/ArturDorochowicz/presentation-enforcing-quality-with-tools</a>
                </small>
            </p>
        </section>

    </div>

</div>

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>

<script>

Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
    transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

    // Optional libraries used to extend on reveal.js
    dependencies: [
        { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
        { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
    ]
});

</script>

</body>
</html>
